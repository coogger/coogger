<script>
    $(document).ready(function() {
      $(".report").click(function(event){
        var content_id = this.getAttribute("data-content-id");
        $("body").load(`{% url 'report' %}?content_id=${content_id}`);
      });
    {% if request.user.is_authenticated %}
      $(".upvote").click(function(event){
        const voter = "{{ request.user }}";
        const author = this.getAttribute("data-user");
        const permlink = this.getAttribute("data-permlink");
        const weight = {{ request.user.otherinformationofusers.vote_percent }}*100
        const id = this.getAttribute("data-id");
        $(this).attr({'animation':"blink i"});
        api.vote(voter, author, permlink, weight, function (err, res) {
            console.log(res,"voted"); // is it necessary to below codes
            steem.api.getContent(author, permlink, function(err, content) {
              var post_reward_total = 0;
              if (pending_payout_value == 0){
                var total_payout_value = parseFloat(content.total_payout_value.replace(" SBD", ""))
                var curator_payout_value = parseFloat(content.curator_payout_value.replace(" SBD", ""));
                post_reward_total = total_payout_value+curator_payout_value;
              }
              else{
                post_reward_total = pending_payout_value;
              }
              $(this).html("<i gnrl='c-primary brc-primary br-2 b-1' class='fa fa-thumbs-up'></i>");
              $(`#${id} #post_reward_total`).text(post_reward_total.toFixed(2));
              $(this).attr({'animation':""});
            });
        });
      });
    {% endif %}
    myElements = document.querySelectorAll('card')
    var accounts = [];
    for (var i = 0; i < myElements.length; i++) {
      const id = myElements.item(i).id;
      const author = id.split("-")[0];
      const permlink = id.replace(`${author}-`,"");
      $(`#${id} .carduserimg`).attr("src",`https://steemitimages.com/u/${author}/avatar`);
      accounts.push(author);
      steem.api.getContent(author, permlink, function(err, content) {
        let json_metadata = JSON.parse(content.json_metadata);
        let app_version = json_metadata.app;
        let community_name, topic, category, language;
        if (app_version == "coogger/1.3.9"){
          community_name = json_metadata.community;
          topic = json_metadata.topic;
          category = json_metadata.category;
          language = json_metadata.language;
        }
        else if (app_version == "coogger/1.4.0"){
          let coogger_ecosystem = json_metadata.ecosystem;
          community_name = coogger_ecosystem.community;
          topic = coogger_ecosystem.topic;
          category = coogger_ecosystem.category;
          language = coogger_ecosystem.language;
        }
        $(`#${id} #language`).attr("href", `/language/${language}`);
        $(`#${id} #language`).html(language);
        $(`#${id} #category`).attr("href", `/category/${category}`);
        $(`#${id} #category`).html(category);
        var active_votes = content.active_votes;
        var upvoted = false;
        {% if request.user.is_authenticated %}
          for (var vot = 0; vot < active_votes.length; vot++) {
            // Todo ; I must add, if already users upvoted any post and if click again, it must be removed its voted
            if ("{{request.user}}" == active_votes[vot].voter){
              $(`#${id} #upvote`).html("<i gnrl='c-primary' hvr='c-danger' class='fa fa-thumbs-up'></i>");
              upvoted = true;
              break;
            }
          }
        {% endif %}
        if(upvoted == false){
          $(`#${id} #upvote`).html("<i hvr='c-primary' gnr='c-secondary' class='fa fa-thumbs-up'></i>");
        }
        var reputation = steem.formatter.reputation(content.author_reputation);
        var pending_payout_value = parseFloat(content.pending_payout_value.replace(" SBD", ""));
        var post_reward_total = 0;
        if (pending_payout_value == 0){
          var total_payout_value = parseFloat(content.total_payout_value.replace(" SBD", ""))
          var curator_payout_value = parseFloat(content.curator_payout_value.replace(" SBD", ""));
          post_reward_total = total_payout_value+curator_payout_value;
        }
        else{
          post_reward_total = pending_payout_value;
        }
        $("#"+id+" #dor").html(dor(content.body));
        $("#"+id+" #created").html(timeSince(content.created));
        $("#"+id+" #reply").html(content.children);
        $("#"+id+" #absolute_url_href").attr("href",`/@${content.author}/${content.permlink}`);
        $("#"+id+" #title").html(content.title);
        $("#"+id+" #author_href").attr("href",`/@${author}`);
        $("#"+id+" #reputation").text(reputation);
        $("#"+id+" #post_reward_total").text(post_reward_total.toFixed(2));
      });
    }
    });
</script>
