<script type="text/javascript">
    $(document).ready(function() {
      let load_comments = true;
        if (load_comments && scrolledbottom()){
            load_comments = false;
            load_replies("{{ detail.id }}")
        }
        else{
          $(window).scroll(function() {
              if (load_comments && scrolledbottom()){
                load_comments = false;
                load_replies("{{ detail.id }}")
              }
            });
        }
      $("#send-reply").click(function(){
        $(this).attr("animation-hover", "i blink");
        let get_comment = $("#id_body").val();
        if (get_comment != ""){
          $.ajax({
            type: "POST",
            url: window.location.href,
            data: {
              "body": get_comment,
              "csrfmiddlewaretoken": "{{ csrf_token }}",
            },
          }).done(function(new_reply) {
            new_reply = JSON.parse(new_reply);
            document.getElementById("id_body").value = ""
            $(this).attr("animation-hover", "null");
            let new_reply_template = reply_info(`/@${new_reply.username}/${new_reply.permlink}`) + reply_userinfo(new_reply) + reply_body(new_reply);
            $("#comment_template").append(new_reply_template);
          });
        }
        else{
          alert("Empty comments cannot be published.")
        }
    })
  });
</script>
<div general="b-1 br-2 brc-muted">
    <div default="paragraph" general="bg-white" style="padding: 6px 4px;">
        {{ reply_form }}
        <button id="send-reply" general="right b-1 br-2 brc-muted bg-success c-white" 
        data-parent_author="{{ detail.user }}" data-parent_permlink="{{ detail.permlink }}">
          Reply
        </button>
        <div id="comment_template" class="comment_template"></div>
    </div>
  </div>